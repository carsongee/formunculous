{% extends "formunculous/base.html" %}

{% load i18n  widget_type %}
{% block css %}
{{ block.super }}
{{ form.media }}
<link href="{{ MEDIA_URL }}formunculous/css/formunculous.css" rel="stylesheet" type="text/css" />
<link href="{{ MEDIA_URL }}formunculous/css/apply.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{ MEDIA_URL }}formunculous/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}formunculous/js/jquery.formset.js"></script>

{% if subforms %}
<script type="text/javascript" src="{{ MEDIA_URL }}formunculous/js/apply_sub_form.js"></script>

<script type="text/javascript">
  jQuery(function($) {
    {% for subform in subforms %}
    $('#formset-{{ subform.formset.prefix }} .apply_sub_form_form').formset({
      prefix: '{{ subform.formset.prefix }}',
      formCssClass: 'dynamic-formset-{{subform.formset.prefix}}',
      addText: 'Add Another Form',
      addCssClass: 'apply_sub_form_addlink',
      deleteText: 'Remove',
      deleteCssClass: 'apply_sub_form_deletelink',
      maxForms: {{ subform.formset.max_num }},
      alertText: '{% trans "You have reached the maximum number of forms for this group"%}'
    });
    {% endfor %}
  });
</script>
{% endif %}
{% endblock %}
{% block title %}{{ ad.name }}{% endblock %}
{% block content_title %}{{ ad.name }}{% endblock %}
{% block content %}
{% if message %}
<div class="apply_messages">{{ message }}</div>
{% endif %}
<form method="post" action="{% url formunculous-apply ad.slug %}"{% if form.is_multipart %} enctype="multipart/form-data"{% endif %}>
  {% if form.errors %}
  <div class="apply_field_errors">{% trans "There are errors in your form, please correct them" %}</div>
  {% endif %}
  <fieldset class="apply_fieldset">
	{% for field in fields %}
  	{% if field.field.is_hidden %}
	{{ field.field }}
	{% else %}

	{{ field.pre_text }}

	{% ifchanged field.group %}
	{% if field.group %}
	<div class="apply_form_group">
	  {% else %}
	  {% if not forloop.first %}
	</div>
	{% endif %}
	{% endif %}
	{% endifchanged %}
	{% widget_type field.field.field.widget as widget %}
	<div class="apply_field_row {% cycle 'odd' '' %} ">
	  <div class="apply_field_errors">{{ field.field.errors }}</div>
	  <div class="apply_field{% if field.required %} apply_required{% endif %}">
		{%  ifequal widget "CheckboxInput" %}
		{{ field.field }}
		{% if field.field.label %}
		<label for="{{ field.field.auto_id}}" class="apply_cb_label">
		  {{field.field.label}}
		</label>
		{% endif %}
		{% else %}
  		{% if field.field.label %}
 		{{ field.field.label_tag }}
		{% endif %}
		{{ field.field }}
		{% endifequal %}
	  </div>
	  <div style="clear:both;"></div>
	  {% if field.field.help_text %}
	  <div class="apply-info-box">
		{{ field.field.help_text }}
	  </div>
	  {% endif %}
	</div>
	{% if forloop.last and field.group %}
</div>
{% endif %}
{{ field.post_text }}
{% endif %}
{% endfor %}
</fieldset>


{# Begin displaying all the subform formsets #}
{% for subform in subforms %}
<div class="apply_sub_form_container">
  <div class="apply_sub_form_title">
	<span class="apply_sub_form_field_collapse" style="margin-top: 6px"></span>
	<h3>{{ subform.sub_ad.name }}</h3>
  </div>
  <div class="apply_sub_form_body" id="formset-{{ subform.formset.prefix }}">
	{{ subform.formset.management_form }}
	{% if subform.formset.non_form_errors %}
	<div class="apply_field_errors">
	  {{ subform.formset.non_form_errors }}
	</div>
	{% endif %}
	{% for form in subform.forms %}
	<div class="apply_sub_form_form{% cycle ' ' " apply_sub_form_odd" %}">
	  {% if form.form.errors %}
	  <div class="apply_field_errors">
		{% trans "There are errors in your form, please correct them" %}
	  </div>
	  {% endif %}
	  <fieldset class="apply_fieldset">
		{% for field in form.fields %}
  		{% if field.field.is_hidden %}
	    {{ field.field }}
		{% else %}

	    {{ field.pre_text }}

	    {% ifchanged field.group %}
	    {% if field.group %}
	    <div class="apply_form_group">
	      {% else %}
	      {% if not forloop.first %}
	    </div>
		{% endif %}
	    {% endif %}
		{% endifchanged %}
		{% widget_type field.field.field.widget as widget %}
	    <div class="apply_field_row {% cycle 'odd' 'even' %} ">
	      <div class="apply_field_errors">{{ field.field.errors }}</div>
	      <div class="apply_field{% if field.required %} apply_required{% endif %}">
			{%  ifequal widget "CheckboxInput" %}
			{{ field.field }}
			{% if field.field.label %}
			<label for="{{ field.field.auto_id}}" class="apply_cb_label">
			  {{field.field.label}}
			</label>
			{% endif %}
			{% else %}
  			{% if field.field.label %}
 			{{ field.field.label_tag }}
			{% endif %}
			{{ field.field }}
			{% endifequal %}
	      </div>
		  <div style="clear:both;"></div>
		  {% if field.field.help_text %}
		  <div class="apply-info-box">
			{{ field.field.help_text }}
		  </div>
		  {% endif %}
		</div>
	    {% if forloop.last and field.group %}
    </div>
    {% endif %}
	{{ field.post_text }}
	{% endif %}
	{% endfor %}
  </div>
  
  {% endfor %}
</div>
</div>
{% endfor %}
<div class="apply_submit{% if subforms %} apply_sub_form_submit{% endif %}">
  {% if ad.authentication %}<input type="submit" name="save" value="Save" />{% endif %}<input type="submit" name="submit" value="Submit" />
</div>

</form>
{% endblock %}
